<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
                      "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
<title>XML: [xml] testXPath memory leak?</title>
<meta name="Author" content="Diego Hernan Weizel (DHWeizel@sif.com.ar)">
<meta name="Subject" content="[xml] testXPath memory leak?">
<link rev="made" href="mailto:veillard@w3.org">
</head>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000">
<h1>[xml] testXPath memory leak?</h1>
<!-- received="Tue Sep  5 10:42:05 2000" -->
<!-- isoreceived="20000905144205" -->
<!-- sent="Tue, 5 Sep 2000 11:32:23 -0300 " -->
<!-- isosent="20000905143223" -->
<!-- name="Diego Hernan Weizel" -->
<!-- email="DHWeizel@sif.com.ar" -->
<!-- subject="[xml] testXPath memory leak?" -->
<!-- id="62F8B2A3EC489F42AD464706169205EF2C7AAE@marte.sif.com.ar" -->
<div align="center">
<table border="2" width="100%">
<tr>
<th><a href="date.html">Date view</a></th>
<th><a href="index.html">Thread view</a></th>
<th><a href="subject.html">Subject view</a></th>
<th><a href="author.html">Author view</a></th>
</tr>
</table>
</div>
<p>
<strong>From:</strong> Diego Hernan Weizel (<a href="mailto:DHWeizel@sif.com.ar?subject=Re:%20[xml]%20testXPath%20memory%20leak?"><em>DHWeizel@sif.com.ar</em></a>)<br>
<strong>Date:</strong> Tue Sep 05 2000 - 10:32:23 EDT
<p>
<!-- next="start" -->
<ul>
<li><strong>Previous message:</strong> <a href="0732.html">Daniel Veillard: "Re: [xml] More uri.c bugs"</a>
<!-- nextthread="start" -->
<!-- reply="end" -->
</ul>
<hr noshade><p>
<!-- body="start" -->
<p>
Hello, first I request excuses by my English because it is not my native
<br>
language.
<br>
<p>I have an  &quot;test.xml&quot; file containing following :
<br>
----------------------------------------------------------------------------
<br>
<pre>
----
&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;BODY&gt;
&lt;DECLARACION importador=&quot;123456789&quot; fecha=&quot;08/09/2000&quot;
monto_factura=&quot;100.09&quot; pa
&lt;ITEM monto=&quot;50.12&quot; divisa=&quot;DOL&quot;&gt;
&lt;SUFIJO codigo=&quot;NL34&quot; valor=&quot;negro&quot;/&gt;
&lt;SUFIJO codigo=&quot;AS34&quot; valor=&quot;grande&quot;/&gt;
&lt;/ITEM&gt;
&lt;/DECLARACION&gt;
&lt;FIRMA&gt;N&lt;/FIRMA&gt;
&lt;/BODY&gt;
----------------------------------------------------------------------------
----
I'm using libxml 2.2.2 and I'd like to be able to select first node &quot;ITEM&quot;
using an XPath expression like:
<p>testXPath -i test.xml &quot;//ITEM[1]&quot;
<p><p>Object is a Node Set :
Set contains 1 nodes:
1    ELEMENT ITEM
      ATTRIBUTE monto
        TEXT
        content=50.12
      ATTRIBUTE divisa
        TEXT
        content=DOL
<p>The result is Ok., but when I watch the file .memorydump I found the
following thing: 
cat .memdump
<p>      Tue Sep  5 10:47:38 2000
<p>      MEMORY ALLOCATED : 80, MAX was 11036
BLOCK  NUMBER   SIZE  TYPE
0         307     28 malloc()  in xpath.c(713)
1         304     40 malloc()  in xpath.c(373)
2         303     12 malloc()  in xpath.c(365) pointer to #304 at index 8
<p>Is this a memry leak? The problem seems to be in the function
xmlXPathEvalPredicate in the line:
<p>/*      This line was missed out:       */
ctxt-&gt;context-&gt;nodelist = xmlXPathNodeSetCreate(ctxt-&gt;context-&gt;node);
<p>It would not be necessary to release this object?
<p>/*Copy the contents of the temporary list back to the node list for the next
round
//ctxt-&gt;context-&gt;nodelist =
xmlXPathNewNodeSetList(listHolder-&gt;nodesetval)-&gt;nodesetval
<p>Is not being lost an object when making the call to nodesetval?
<p>We released the objects and solved the problem, but we are not sure that it
is the correct form.
<p>----
Message from the list <a href="mailto:xml@rpmfind.net?subject=Re:%20[xml]%20testXPath%20memory%20leak?">xml@rpmfind.net</a>
Archived at : <a href="http://xmlsoft.org/messages/">http://xmlsoft.org/messages/</a>
to unsubscribe: echo &quot;unsubscribe xml&quot; | mail  <a href="mailto:majordomo@rpmfind.net?subject=Re:%20[xml]%20testXPath%20memory%20leak?">majordomo@rpmfind.net</a>
</pre>
<p><!-- body="end" -->
<hr noshade>
<ul>
<!-- next="start" -->
<li><strong>Previous message:</strong> <a href="0732.html">Daniel Veillard: "Re: [xml] More uri.c bugs"</a>
<!-- nextthread="start" -->
<!-- reply="end" -->
</ul>
<div align="center">
<table border="2" width="100%">
<tr>
<th><a href="date.html">Date view</a></th>
<th><a href="index.html">Thread view</a></th>
<th><a href="subject.html">Subject view</a></th>
<th><a href="author.html">Author view</a></th>
</tr>
</table>
</div>
<!-- trailer="footer" -->
<p>
<small>
<em>
This archive was generated by <a href="http://www.hypermail.org/">hypermail 2b29</a> 
: <em>Tue Sep 05 2000 - 10:43:40 EDT</em>
</em>
</small>
</body>
</html>
